#!/bin/bash

if [ $# -eq 0 ]; then
    echo 'Need file name.'
    exit 0
fi

# ----------- General variables -----------------
dir="debug_files/"
name=${1%.*}

# ---------- Generating binary files ------------
nasm -f elf32 $1 -o ${dir}$name.o
ld -melf_i386 -o ${dir}$name ${dir}$name.o

# ------ Generating C hex of the bin code -------
objcopy -O binary -j .text ${dir}${name}.o ${dir}${name}_c_hex.txt
echo $(od -An -t x1 ${dir}${name}_c_hex.txt) > ${dir}${name}_c_hex.txt
sed -i -e '1s:^:\\x:g' -e 's:\ :\\x:g' ${dir}${name}_c_hex.txt

echo -e "\n------------ hex payload ------------\n"

cat ${dir}${name}_c_hex.txt
